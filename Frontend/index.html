<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>ğŸš€ Pro MaÄŸaza YÃ¶netimi</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 700px; margin: 0 auto 20px auto; }
        input { padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 6px; width: calc(100% - 22px); }
        button { border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-ekle { background-color: #27ae60; color: white; width: 100%; }
        .btn-sil { background-color: #e74c3c; color: white; margin-left: 5px; }
        .btn-satin-al { background-color: #007bff; color: white; }
        .arama-kutusu { background-color: #fff; border: 2px solid #007bff; font-size: 1.1em; }
        li { background: #fff; margin-bottom: 10px; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee; }
        .stok-sayi { font-weight: bold; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>ğŸ“± Pro MaÄŸaza YÃ¶netim Paneli</h1>

    <div class="panel">
        <input type="text" id="arama-input" class="arama-kutusu" placeholder="ğŸ” ÃœrÃ¼n ara (YazdÄ±kÃ§a filtrelenir...)" onkeyup="aramaYap()">
    </div>

    <div class="panel">
        <h3>â• Yeni ÃœrÃ¼n Ekle</h3>
        <input type="text" id="yeni-ad" placeholder="ÃœrÃ¼n AdÄ±">
        <input type="number" id="yeni-fiyat" placeholder="Fiyat">
        <input type="number" id="yeni-stok" placeholder="Stok">
        <button onclick="yeniUrunEkle()" class="btn-ekle">Ekle âœ¨</button>
    </div>

    <div class="panel">
        <h3>ğŸ›’ ÃœrÃ¼n Listesi</h3>
        <ul id="urun-listesi"></ul>
    </div>

    <script>
        let tumUrunler = []; // Arama yaparken kullanmak iÃ§in tÃ¼m Ã¼rÃ¼nleri burada tutacaÄŸÄ±z

        async function stoklariGetir() {
            try {
                const cevap = await fetch('http://127.0.0.1:8000/stok');
                const veri = await cevap.json();
                tumUrunler = veri.guncel_stok; // Veriyi hafÄ±zaya al
                listeyiCiz(tumUrunler); // Ekrana Ã§iz
            } catch (hata) { console.error(hata); }
        }

        function listeyiCiz(liste) {
            const listeElementi = document.getElementById('urun-listesi');
            listeElementi.innerHTML = ''; 
            liste.forEach(urun => {
                const madde = document.createElement('li');
                const stokRenk = urun.stok_adedi < 3 ? "#e74c3c" : "#f39c12";
                madde.innerHTML = `
                    <div>
                        <strong>${urun.urun_adi}</strong> - ${urun.fiyat} TL<br>
                        <span class="stok-sayi" style="color: ${stokRenk};">Stok: ${urun.stok_adedi}</span>
                    </div>
                    <div>
                        <button class="btn-satin-al" onclick="satinAl('${urun.urun_adi}')">ğŸ›’ SatÄ±n Al</button>
                        <button class="btn-sil" onclick="urunSil('${urun.urun_adi}')">ğŸ—‘ï¸ Sil</button>
                    </div>
                `;
                listeElementi.appendChild(madde);
            });
        }

        // --- ARAMA FONKSÄ°YONU ---
        function aramaYap() {
            const arananKelime = document.getElementById('arama-input').value.toLowerCase();
            const filtrelenmiÅŸListe = tumUrunler.filter(urun => 
                urun.urun_adi.toLowerCase().includes(arananKelime)
            );
            listeyiCiz(filtrelenmiÅŸListe);
        }

        async function yeniUrunEkle() {
            const ad = document.getElementById('yeni-ad').value;
            const fiyat = document.getElementById('yeni-fiyat').value;
            const stok = document.getElementById('yeni-stok').value;
            await fetch('http://127.0.0.1:8000/urun-ekle', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ ad: ad, fiyat: parseFloat(fiyat), stok: parseInt(stok) })
            });
            stoklariGetir();
        }

        async function satinAl(isim) {
            await fetch(`http://127.0.0.1:8000/satin-al/${isim}`, { method: 'POST' });
            stoklariGetir();
        }

        // --- SÄ°LME FONKSÄ°YONU ---
        async function urunSil(isim) {
            if(confirm(`'${isim}' Ã¼rÃ¼nÃ¼nÃ¼ silmek istediÄŸine emin misin?`)) {
                await fetch(`http://127.0.0.1:8000/urun-sil/${isim}`, { method: 'DELETE' });
                stoklariGetir();
            }
        }

        window.onload = stoklariGetir;
    </script>
</body>
</html>
  