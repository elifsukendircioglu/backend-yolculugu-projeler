<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>ğŸ’ Efsane Teknoloji MaÄŸazasÄ±</title>
    <style>
        body { font-family: 'Poppins', sans-serif; background: #eef2f3; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; gap: 20px; max-width: 1200px; width: 100%; }
        .ana-bolum { flex: 3; }
        .yan-panel { flex: 1; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); height: fit-content; }
        .panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .urun-listesi { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .urun-kart { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 10px; text-align: center; }
        .urun-kart img {
    width: 100%;
    height: 150px;       /* YÃ¼ksekliÄŸi biraz artÄ±rdÄ±k */
    object-fit: contain; /* 'cover' yerine 'contain' yaparsak resmin tamamÄ± gÃ¶rÃ¼nÃ¼r */
    background-color: #f9f9f9; /* Resim sÄ±ÄŸmazsa kenarlar boÅŸ kalmasÄ±n diye hafif gri fon */
    border-radius: 8px;
}
        .stok-kritik { color: red; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        input { padding: 8px; margin: 5px 0; width: 90%; border-radius: 5px; border: 1px solid #ccc; }
        button { cursor: pointer; border: none; padding: 8px 12px; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .btn-al { background: #007bff; color: white; width: 100%; margin-top: 5px; }
        .btn-sil { background: #ff4757; color: white; font-size: 10px; margin-top: 5px; }
    </style>
</head>
<div class="container" style="margin-bottom: 20px;">
    <div class="panel" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
        <h4>ğŸ’° Toplam Ciro</h4>
        <h2 id="toplam-ciro">0 TL</h2>
    </div>
    <div class="panel" style="flex: 1; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; text-align: center;">
        <h4>ğŸ”¥ En Ã‡ok Satan</h4>
        <h2 id="en-populer">-</h2>
    </div>
</div>
<body>

    <h1>ğŸ’ Efsane Teknoloji MaÄŸazasÄ±</h1>
    <div class="container" style="margin-bottom: 20px; display: flex; gap: 20px; width: 100%; max-width: 1200px;">
    <div class="panel" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; border: none;">
        <h4 style="margin: 0; opacity: 0.8;">ğŸ’° Toplam Ciro</h4>
        <h2 id="toplam-ciro" style="margin: 10px 0 0 0; font-size: 2.5em;">0 TL</h2>
    </div>
    <div class="panel" style="flex: 1; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; text-align: center; border: none;">
        <h4 style="margin: 0; opacity: 0.8;">ğŸ”¥ En Ã‡ok Satan</h4>
        <h2 id="en-populer" style="margin: 10px 0 0 0; font-size: 2em;">-</h2>
    </div>
</div>

    <div class="container">
        <div class="ana-bolum">
            <div class="panel">
                <input type="text" id="arama" placeholder="ğŸ” ÃœrÃ¼nlerde ara..." onkeyup="aramaYap()">
            </div>

            <div class="panel">
                <h3>â• Yeni ÃœrÃ¼n</h3>
                <input type="text" id="ad" placeholder="Ad">
                <input type="number" id="fiyat" placeholder="Fiyat">
                <input type="number" id="stok" placeholder="Stok">
                <input type="text" id="resim" placeholder="Resim URL (Link)">
                <button onclick="yeniUrunEkle()" style="background: #2ed573; color: white; width: 100%;">DÃ¼kkana Koy âœ¨</button>
            </div>

            <div class="panel">
                <h3>ğŸ“¦ Raflar</h3>
                <div id="urun-grid" class="urun-listesi"></div>
            </div>
        </div>

        <div class="yan-panel">
            <h3>ğŸ“ Son SatÄ±ÅŸlar</h3>
            <ul id="satis-gecmisi" style="font-size: 13px; color: #555;"></ul>
        </div>
    </div>

    <script>
        let tumUrunler = [];

       async function veriYukle() {
    // 1. ÃœrÃ¼nleri Ã‡ek
    const urunCevap = await fetch('http://127.0.0.1:8000/stok');
    const urunVeri = await urunCevap.json();
    tumUrunler = urunVeri.guncel_stok;
    cizUrunler(tumUrunler);

    // 2. SatÄ±ÅŸ GeÃ§miÅŸini Ã‡ek
    const satisCevap = await fetch('http://127.0.0.1:8000/satis-gecmisi');
    const satisVeri = await satisCevap.json();
    const satisListe = document.getElementById('satis-gecmisi');
    satisListe.innerHTML = satisVeri.satislar.map(s => `<li>âœ… ${s.urun} (${s.tarih.slice(11,16)})</li>`).join('');

    // 3. YENÄ°: MaÄŸaza Ã–zetini (Ciro ve PopÃ¼ler ÃœrÃ¼n) Ã‡ek
    const ozetCevap = await fetch('http://127.0.0.1:8000/magaza-ozet');
    const ozetVeri = await ozetCevap.json();
    
    // HTML'deki ciro ve popÃ¼ler Ã¼rÃ¼n yazÄ±larÄ±nÄ± gÃ¼ncelle
    document.getElementById('toplam-ciro').innerText = ozetVeri.toplam_ciro + " TL";
    document.getElementById('en-populer').innerText = ozetVeri.en_populer;
}

        function cizUrunler(liste) {
            const grid = document.getElementById('urun-grid');
            grid.innerHTML = liste.map(u => `
                <div class="urun-kart">
                    <img src="${u.resim_url || 'https://via.placeholder.com/150'}" alt="urun">
                    <h4>${u.urun_adi}</h4>
                    <p>${u.fiyat} TL</p>
                    <p class="${u.stok_adedi < 3 ? 'stok-kritik' : ''}">Stok: ${u.stok_adedi}</p>
                    <button class="btn-al" onclick="satinAl('${u.urun_adi}')">SatÄ±n Al</button>
                    <button class="btn-sil" onclick="sil('${u.urun_adi}')">Sil</button>
                </div>
            `).join('');
        }

       async function yeniUrunEkle() {
    const ad = document.getElementById('ad').value;
    const fiyat = document.getElementById('fiyat').value;
    const stok = document.getElementById('stok').value;
    const resim = document.getElementById('resim').value; // HTML'deki input ID'si 'resim' olmalÄ±

    if(!ad || !fiyat || !stok) {
        alert("LÃ¼tfen alanlarÄ± doldurun!");
        return;
    }

    const veri = {
        ad: ad,
        fiyat: parseFloat(fiyat),
        stok: parseInt(stok),
        resim_url: resim || "https://via.placeholder.com/150" // BurasÄ± Python'dakiyle aynÄ± olmalÄ±!
    };

    const cevap = await fetch('http://127.0.0.1:8000/urun-ekle', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(veri)
    });

    if (cevap.ok) {
        alert("Eklendi!");
        veriYukle(); 
    } else {
        const hata = await cevap.json();
        console.log("Hata DetayÄ±:", hata);
        alert("Ekleme baÅŸarÄ±sÄ±z! Console'a bak.");
    }
}

        async function satinAl(ad) {
            await fetch(`http://127.0.0.1:8000/satin-al/${ad}`, { method: 'POST' });
            veriYukle();
        }

        async function sil(ad) {
            if(confirm("Silinsin mi?")) {
                await fetch(`http://127.0.0.1:8000/urun-sil/${ad}`, { method: 'DELETE' });
                veriYukle();
            }
        }

        function aramaYap() {
            const kelime = document.getElementById('arama').value.toLowerCase();
            cizUrunler(tumUrunler.filter(u => u.urun_adi.toLowerCase().includes(kelime)));
        }

        window.onload = veriYukle;
    </script>
</body>
</html>