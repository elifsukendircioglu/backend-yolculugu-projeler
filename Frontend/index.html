<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Benim Teknoloji MaÄŸazam</title>
    <style>
        /* Biraz gÃ¶rsellik katalÄ±m */
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .urun-kartÄ± { background: white; padding: 15px; border-radius: 8px; width: 300px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { color: #333; }
        .fiyat { color: green; font-weight: bold; }
        button { background-color: #007bff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <h1>MaÄŸaza YÃ¶netim Paneli</h1>

    <div class="urun-kartÄ±">
        <h2 id="urun-adi">ÃœrÃ¼n YÃ¼kleniyor...</h2>
        <p>Fiyat: <span id="urun-fiyat" class="fiyat">0</span> TL</p>
        <p>Stok: <span id="urun-stok">0</span> adet</p>
        <button onclick="satinAl()">SatÄ±n Al</button>
    </div>

    <script>
        // Åimdilik verileri elimizle yazÄ±yoruz, 
        // ileride burayÄ± Backend (Python) ile baÄŸlayacaÄŸÄ±z!
        let urun = {
            ad: "Macbook Air",
            fiyat: 40000,
            stok: 5
        };

        // Ekranda verileri gÃ¶sterelim
        document.getElementById("urun-adi").innerText = urun.ad;
        document.getElementById("urun-fiyat").innerText = urun.fiyat;
        document.getElementById("urun-stok").innerText = urun.stok;

        function satinAl() {
            if(urun.stok > 0) {
                urun.stok -= 1;
                document.getElementById("urun-stok").innerText = urun.stok;
                alert("ÃœrÃ¼n satÄ±ldÄ±!");
            } else {
                alert("Stok bitti!");
            }
        }
    </script>
    <div id="urunler-alani" style="border: 1px solid #ccc; padding: 20px; margin-top: 20px;">
    <h2>ğŸ›’ GÃ¼ncel Stok Durumu</h2>
    <ul id="urun-listesi">
        <li>HenÃ¼z veri Ã§ekilmedi...</li>
    </ul>
    <button onclick="stoklariGetir()">StoklarÄ± GÃ¼ncelle</button>
</div>

<script>
    async function stoklariGetir() {
        console.log("Butona basÄ±ldÄ±, veri Ã§ekiliyor..."); // Konsolda bunu gÃ¶rmelisin
        
        try {
            const cevap = await fetch('http://127.0.0.1:8000/stok');
            const veri = await cevap.json();
            
            console.log("Gelen Veri:", veri); // Gelen veriyi kontrol et
            
            const listeElementi = document.getElementById('urun-listesi');
            listeElementi.innerHTML = ''; 

            veri.guncel_stok.forEach(urun => {
                const madde = document.createElement('li');
                madde.style.padding = "5px";
                // Eski madde.innerHTML yerine bunu yapÄ±ÅŸtÄ±r:
madde.innerHTML = `
    <strong>${urun.urun_adi}</strong> - ${urun.fiyat} TL 
    (Stok: <span id="stok-${urun.urun_adi}">${urun.stok_adedi}</span>)
    <button onclick="satinAl('${urun.urun_adi}')" style="margin-left:10px; cursor:pointer;">ğŸ›’ SatÄ±n Al</button>
`;
                listeElementi.appendChild(madde);
            });
        } catch (hata) {
            console.error("Eyvah! Veri Ã§ekilirken hata oluÅŸtu:", hata);
            alert("Backend'e baÄŸlanÄ±lamadÄ±. FastAPI Ã§alÄ±ÅŸÄ±yor mu?");
        }
    }
    async function satinAl(isim) {
    const cevap = await fetch(`http://127.0.0.1:8000/satin-al/${isim}`, {
        method: 'POST'
    });
    
    const sonuc = await cevap.json();
    
    if (cevap.ok) {
        alert(sonuc.mesaj);
        stoklariGetir(); // Listeyi otomatik yenile ki yeni stoÄŸu gÃ¶relim!
    } else {
        alert("Hata: " + sonuc.detail);
    }
}
</script>
</body>
</html>